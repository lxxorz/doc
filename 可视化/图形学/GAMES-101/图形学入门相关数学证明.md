# 图形学之数学相关证明

## 约定
| 概念 | 表示                              |
| ---- | --------------------------------- |
| 点积 | $\langle \vec{a},\vec{b} \rangle$ |
| 叉乘 | $\vec{a}\times \vec{b}$           |

## 基本证明

1. 证明 $\vec{a}(\vec{s}\cdot\vec{a})=aa^T\vec{s}$,a 为 unit vector.
$$
\vec{a}(s\cos\theta)
$$
## 旋转矩阵

### 正向旋转

首先推导旋转矩阵，旋转矩阵对任意一点适用，先取一个特殊点 $(1,0)$ 将其旋转 $\theta$ 旋转之后的坐标就是 $(\cos \theta,\sin \theta)$ 设旋转矩阵是
$$
\begin{pmatrix}
a & b \\
c & d
\end{pmatrix}
$$
$$
\begin{pmatrix}
a & b \\
c & d
\end{pmatrix}\begin{pmatrix}
1 \\ 0
\end{pmatrix}=\begin{pmatrix}
\cos \theta \\
\sin \theta
\end{pmatrix}
$$
推导出 $a=\sin \theta$ , $c=\cos \theta$，然后再取特殊点 $(0,1)$ 经过旋转 $\theta$ 之后坐标是 $(\cos \theta,-\sin \theta)$，推导出 $b=\cos \theta,d=-\sin \theta$ 因此得出旋转矩阵是
$$
R_{\theta}=\begin{pmatrix}
\cos \theta & -\sin \theta  \\
\sin \theta & \cos \theta
\end{pmatrix}
$$
### 反向旋转

和正向旋转一样，反向旋转的取特殊点 $(1,0)$ 和 $(0, -1)$
由
$$
\begin{pmatrix}
a & b \\
c & d
\end{pmatrix}\begin{pmatrix}
1 \\
0
\end{pmatrix}=\begin{pmatrix}
\cos \theta \\
-\sin \theta
\end{pmatrix}
$$
$$
\begin{pmatrix}
a & b \\
c & d
\end{pmatrix} 
\begin{pmatrix}
0 \\
-1
\end{pmatrix}=
\begin{pmatrix}
-\sin \theta \\
-\cos \theta
\end{pmatrix}
$$
所以，当旋转 $-\theta$ 时，旋转矩阵是
$$
R_{-\theta}=\begin{pmatrix}
\cos \theta & \sin \theta \\
-\sin \theta & \cos \theta
\end{pmatrix}
$$
对比发现其实 $R_{\theta}^T= R_{-\theta}$，另外 
$$
\begin{align}
R_{\theta}R_{-\theta} &= \begin{pmatrix}
\cos \theta & -\sin \theta  \\
\sin \theta & \cos \theta
\end{pmatrix}\begin{pmatrix}
\cos \theta & \sin \theta \\
-\sin \theta & \cos \theta
\end{pmatrix} \\
 &=\begin{pmatrix}
\cos \cos+\sin \sin & \cos \sin-\cos \sin \\
\sin \cos- \sin \cos & \sin \sin +\cos \cos
\end{pmatrix} \\
&=\begin{pmatrix}
1 & 0 \\
0 & 1
\end{pmatrix} \\
&= I_{2}
\end{align}
$$
### 结论

$R_{-\theta}$ 不仅是 $R_{\theta}$ 的转置矩阵而且是它的逆矩阵


## 三维空间旋转矩阵的推导
![[rotation-axis.png]]
1. 假定旋转轴为 x 轴，从 y 向 z 旋转 $\theta$ ，分别取点 $(x, 1, 0)$ $(x,0,1)$，可得
$$
R_{\theta}=
\begin{pmatrix}
1 & 0 & 0  \\
0 & \cos \theta & -\sin \theta \\
0 & \sin \theta & \cos \theta
\end{pmatrix}
$$
需要注意的是由于是 $z\to x$ （其他两个变换矩阵是 $y\to z$ 和 $x\to y$）所以 $R_{yz}$ 看起来略有不同。
![[y-rotation-axis.png]]
以上都是针对某一个特定轴进行旋转的

### 罗德里格斯公式推导
上面的旋转公式都是针对 x 轴或者 y 轴和 z 轴，但如果是任意轴呢？我们可以使用通过基本的旋转（x, y, z 轴）来组合变换达到目的吗？答案是可以，这里引入**罗德里格斯（Rouge ）公式**，相关的推导过程参考了 [YouTube 罗德里格斯公式推导](https://www.youtube.com/watch?v=Fh3nMi87cB8&ab_channel=ChristopherLum)

前置知识
1. 如何计算投影，假设 $\vec{a}$ 向 $\vec{j}$ 旋转 $\theta$ 那么 $\vec{a}$ 在 $\vec{b}$ 上的投影是？
$$
proj_{a} = \frac{\langle \vec{a}, \vec{b} \rangle \vec{a}}{|\vec{b}|^2}
$$
如果 $\vec{b}$ 是一个单位向量，那么会更简单一点，$proj= \langle \vec{a}, \vec{b} \rangle\vec{b}$，如果
2. 向量的叉乘 (cross product)
向量的尝叉乘仅仅在三维空间下有定义，其计算公式是
$$
\vec{P}\vec{Q}=|\vec{P}| |\vec{Q}|\sin\theta \vec{N}
$$
注意这里的 $\vec{N}$ 是垂直于 $\vec{P}$ 和 $\vec{Q}$ 所在平面的一个单位向量，其方向由右手定则决定。他的方向也是最终叉乘结果向量的方向。（食指指向 $\vec{P}$ 中指指向 $\vec{Q}$ ，那么拇指就是单位向量的方向了）
![[right-handle-law.png]]
假设旋转轴是 $\hat{N}$，则罗德里格斯公式可以表示成 $\vec{V} = \vec{ON} +\vec{NW} + \vec{WV}$
![[罗德里克斯公式.png]]

接下来一次对每个向量进行求解 ($\vec{ON}, \vec{NW}, \vec{WV}$)，首先根据投影公式
$$
\vec{ON} = \frac{\langle \vec{u},\vec{n} \rangle \vec{n}}{\lvert\vec{n}\rvert^2}
$$
其中 $\vec{n}$ 是个单位向量 (unit vector)，因此可以写成 
$$
\vec{ON}=\langle \vec{u},\vec{n} \rangle\vec{n}
$$

接下来是第二个向量 $\vec{NW}$，注意观察，$\vec{NW}$ 是向量 $\vec{NV}$ 的投影向量也就是  $$
\vec{NW}=\frac{\lvert\vec{NV}\rvert\cos\mu \vec{NU}}{\lvert\vec{NU}\rvert}
$$
因为 $\vec{NV}$ 和 $\vec{NU}$ 都是圆上的直径，所以可以抵消, 而其中 $\vec{NU}$ 是 $\vec{u}-\vec{ON}$ 
$$
\begin{align}
\vec{NW}&=\cos\mu(\vec{u}-\vec{ON}) \\
&=\cos\mu(\vec{u}-\langle \vec{u},\vec{n} \rangle\vec{n})
\end{align}
$$


接下来是第三个向量 $\vec{WV}$，其垂直于 $\vec{ON}$ 和 $\vec{u}$ 构成的平面其单位向量可以通过 $$\hat{WV}=\frac{\vec{u}\times\vec{n}}{\lvert\vec{u}\rvert\lvert\vec{n}\rvert\sin\phi}$$
所以
$$
\begin{align}
\vec{WV} &= \lvert\vec{NV}\rvert\sin\mu \hat{WV} \\
&= \lvert\vec{u}\rvert\sin\phi \sin\mu\left( \frac{\vec{u}\times\vec{n}}{\lvert\vec{u}\rvert\lvert\vec{n}\rvert\sin\phi} \right) \\
&=\frac{\sin\mu(\vec{u}\times\vec{n})}{\lvert\vec{n}\rvert} \\
&= \sin\mu(\vec{u}\times \vec{n}) 
\end{align}
$$

到此可以得到罗德里格斯公式的基本形态
$$
\vec{V}=\langle \vec{u},\vec{n} \rangle\vec{n} + \cos\mu(\vec{u}-\langle \vec{u},\vec{n} \rangle\vec{n}) + \sin\mu(\vec{u}\times \vec{v}) 
$$
在经过一些代数变换之后就变成
$$
\vec{V}=(1-\cos(\mu))\langle \vec{u},\vec{n} \rangle \vec{n}+\cos(\mu)\vec{u}+\sin\mu(\vec{u}\times\vec{n})
$$
至此，罗德里格式公式推导完毕。这里的 $\vec{u}$ 就是我们的初始向量，$\vec{V}$ 就是绕旋转轴 $\vec{n}$ 旋转 $\mu$ 之后的最终向量

将罗德里格斯公式提取出来矩阵就是
$$
\vec{u'}=R\vec{u}
$$
在 GAMES 101, 有另外的[证明方式](https://games-cn.org/forums/topic/graphics-intro-hw0/)
