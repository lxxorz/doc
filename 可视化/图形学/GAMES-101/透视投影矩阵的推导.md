# 透视投影矩阵的推导
##  将透视投影frstum“压缩”成正交投影frstum
在平行投影中，两条直线永远不会相交，但是在透视投影中，物体呈现出近大远小的状态，两条平行的直线最终是会相交的，就像图中的两条铁轨一样
![](perspective_example.jpeg)

[Open: Pasted image 20231119232140.png](%E5%8F%AF%E8%A7%86%E5%8C%96/%E5%9B%BE%E5%BD%A2%E5%AD%A6/GAMES-101/assets/a3caac6fd59ee3042d7d39393b408dfe_MD5.jpeg)
![](%E5%8F%AF%E8%A7%86%E5%8C%96/%E5%9B%BE%E5%BD%A2%E5%AD%A6/GAMES-101/assets/a3caac6fd59ee3042d7d39393b408dfe_MD5.jpeg)
透视投影有点类似小孔成像的原理，同样大小的物体，在远处的物体投影到平面上会更小。实现透视投影变换也需要定义一个视锥体（viewing frstum）。通常用一个四元组表示 $(fov, aspectRatio,zNear, zFar)$，要推导透视投影变换，可以先将透视投影变换转换成正交投影变换。因为透视投影变换和正交投影变换的区别仅在于 viewing frstum 不同，最终都是讲 viewing frstum 移动到原点并归一化。所以第一步就是将 frstum 变成长方体，之后的操作就和正交投影变换一模一样

![](perspective-2D.jpeg)
假设从 frstum 的变换矩阵是
$$
A=\begin{pmatrix}
a & b & c & d \\
e & f & g & h \\
i & j & k & l \\
o & p & q & r
\end{pmatrix}
$$

取远平面上的点 $(x,y,z)$ ，经过挤压之后，其坐标是 $(x',y',z')$，

[Open: Pasted image 20231119235541.png](%E5%8F%AF%E8%A7%86%E5%8C%96/%E5%9B%BE%E5%BD%A2%E5%AD%A6/GAMES-101/assets/507fdbf3b1724866203d5a33e2ee50fb_MD5.jpeg)
![](%E5%8F%AF%E8%A7%86%E5%8C%96/%E5%9B%BE%E5%BD%A2%E5%AD%A6/GAMES-101/assets/507fdbf3b1724866203d5a33e2ee50fb_MD5.jpeg)

由上图可知
$$
\frac{y'}{y}=\frac{zNear}{z}
$$
所以 $y'=\frac{zNear}{z}y$，同理 $x'=\frac{zNear}{z}x$ 
$$
A\begin{pmatrix}
x \\
y \\
zFar \\
1
\end{pmatrix}
=
\begin{pmatrix}
\frac{zNear}{z}x \\
\frac{zNear}{z}y \\
zFar \\
1
\end{pmatrix}
$$

发现经过变换之后 $x'$ 以及 $y'$ 和 $z$ 有了关系，不过由于在齐次坐标下，点的坐标表示不止一种
$$
\begin{pmatrix}
x \\
y \\
z \\
1
\end{pmatrix}
=
\begin{pmatrix}
xz \\
yz \\
zz \\
z
\end{pmatrix}
=\begin{pmatrix}
zNear\cdot x \\
zNear\cdot y \\
z^2 \\
z
\end{pmatrix}
$$

 